# Environment Variables Setup for Vercel Deployment

## Database Configuration

For Vercel PostgreSQL deployment, you'll need these environment variables:

```
# PostgreSQL Database URL (from Vercel Postgres)
# Use POSTGRES_URL_NON_POOLING to avoid connection limit issues
DATABASE_URL=postgres://user:password@host:port/database?sslmode=require

# Fallback for development (if using local PostgreSQL)
# DATABASE_URL=postgres://localhost:5432/eco_decision_db
```

## AI Integration Configuration

If using OpenAI or other AI service:

```
# OpenAI API Configuration
AI_INTEGRATIONS_OPENAI_API_KEY=sk-xxxxxxxxxxxxx
AI_INTEGRATIONS_OPENAI_BASE_URL=https://api.openai.com/v1

# Alternative: Use a custom base URL if needed
# AI_INTEGRATIONS_OPENAI_BASE_URL=https://your-proxy-url.com
```

## Application Configuration

```
# Node Environment
NODE_ENV=production

# Server Port (Vercel will set this automatically on production)
PORT=3000

# Vercel specific
VERCEL_URL=your-project.vercel.app
```

## Getting Database URL from Vercel

1. Go to [Vercel Dashboard](https://vercel.com/dashboard)
2. Select your project
3. Go to **Settings** → **Environment Variables**
4. Look for `POSTGRES_URL_NON_POOLING`
5. Copy the value and set it as `DATABASE_URL`

Alternatively, via Vercel CLI:
```bash
vercel env pull
# This will create a .env.local file with all variables
```

## Deployment Instructions

### Step 1: Push to GitHub
```bash
git add .
git commit -m "Migrate to Vercel with PostgreSQL"
git push origin main
```

### Step 2: Connect to Vercel
```bash
# Option A: Via Vercel Dashboard
# 1. Go to vercel.com/new
# 2. Import your GitHub repository
# 3. Add environment variables

# Option B: Via Vercel CLI
vercel link  # Link existing project or create new
vercel env add DATABASE_URL  # Add your PostgreSQL URL
vercel deploy --prod
```

### Step 3: Initialize Database

Option A - Using Drizzle Kit (Recommended):
```bash
vercel env pull
npm run db:push
```

Option B - Using psql directly:
```bash
psql "your_postgres_url" -f database.sql
```

## Verification Checklist

- [ ] Database URL is set in Vercel env vars
- [ ] OpenAI API key is configured (if using AI)
- [ ] Database schema is initialized (`SELECT * FROM users;` returns no error)
- [ ] Build command succeeds: `npm run build`
- [ ] Start command works: `npm start`
- [ ] API endpoints are responding
- [ ] Frontend is serving correctly

## Troubleshooting

### Build Fails With Database Error
```bash
# Verify DATABASE_URL is set
vercel env list

# Check if database is accessible
npm run db:generate  # This just creates migration files
```

### Connection Timeout
- Ensure Vercel postgres IP whitelist includes Vercel IPs (automatic)
- Use `POSTGRES_URL_NON_POOLING` if using Vercel Postgres
- Check if database is in the same region as your function

### Port 5000 vs 3000
- Vercel uses the PORT environment variable
- Default to 3000 for Vercel if not specified
- Server will listen on `0.0.0.0:PORT`

## Security Best Practices

✅ **Do:**
- Store sensitive keys in Vercel's Environment Variables
- Use `POSTGRES_URL_NON_POOLING` for serverless functions
- Enable HTTPS (automatic on Vercel)
- Use strong database passwords

❌ **Don't:**
- Commit `.env` or `.env.local` to git
- Use `DATABASE_URL` directly in code
- Share API keys in logs or error messages
- Leave database publicly accessible
